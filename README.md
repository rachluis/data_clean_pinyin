# Excel 拼音自动清洗工具 (README)

## 1. 介绍
本程序 (`gui_cleaner_pyqt.exe`) 是一个图形界面工具，用于自动清洗 Excel 文件中的数据。

## 2. 核心功能与逻辑
本工具的主要工作是，读取一个Excel工作表，并根据 `clientname` 列（中文名）来修正 `patientcode` 列（编码）中错误的拼音部分。

**本程序的核心逻辑分为三步：**

1.  **校验 (Validation):**
    * 当您点击“开始清洗”后，程序**不会**立即处理整个文件。
    * 它会首先“试探性”地读取您指定的Excel工作表（Sheet）的**表头**。
    * 它会**检查**该表头中是否**同时存在** `clientname` 和 `patientcode` 这两个列标题。
    * **如果缺少任意一个**，程序将**立即停止**并弹窗报错（例如：“字段校验失败！未在Sheet中找到 clientname”），您的原始文件不会被做任何修改。

2.  **清洗 (Cleaning):**
    * **只有在校验通过后**，程序才会开始正式读取所有数据。
    * 它会逐行将 `clientname` 列的中文名（例如：“艾齐”）转换为标准的汉语拼音（例如：“AIQI”）。
    * 然后，它会用这个正确的拼音，去替换 `patientcode` 列中第一个下划线 `_` 前的错误拼音部分（例如：将 `AIZUO_20250819_01` 修正为 `AIQI_20250819_01`）。

3.  **保存 (Saving):**
    * 清洗完成后，程序会将修改后的全部数据**写回并覆盖**您原始Excel文件中的**同一个工作表（Sheet）**。

## 3. 如何使用 (步骤)

1.  **备份文件 (!!!最重要!!!)**
    在开始之前，请**务必将您要处理的Excel文件复制一份作为备份**。因为本程序会直接修改您的原始文件。

2.  **运行程序**
    双击打开 `gui_cleaner_pyqt.exe` 程序。

3.  **选择文件**
    点击“浏览...”按钮，找到并选择您需要清洗的 `.xlsx` 或 `.xls` 文件。

4.  **确认工作表 (Sheet)**
    * 程序会默认在“Sheet 名称”框中填入 `dw_eagle_sale2_atm`。
    * 如果您的Excel中需要处理的工作表**不叫这个名字**，请**务必**在此处修改为正确的Sheet名称（注意大小写和空格）。

5.  **关闭Excel文件**
    在点击“开始清洗”之前，请**确保您要处理的那个Excel文件已经完全关闭**。否则程序将无法保存数据。

6.  **开始清洗**
    * 点击“开始清洗”按钮。
    * 按钮会变为“正在处理...”，并且下方的状态栏会显示当前进度（例如：“正在读取文件并校验字段...”）。
    * 请耐心等待，直到弹窗提示“任务完成”或“发生错误”。

## 4. 常见问题 (Troubleshooting)

* **错误：“发生错误：字段校验失败！...”**
    * **原因**: 您指定的Sheet中，找不到 `clientname` 或 `patientcode` 这两个列标题。
    * **解决**: 打开您的Excel文件，检查表头是否包含这两列，或者检查您的拼写是否完全正确。

* **错误：“发生错误：保存文件失败！...” 或 "PermissionError"**
    * **原因**: 您要处理的Excel文件仍然被Excel或其他程序打开着。
    * **解决**: **关闭该Excel文件**，然后重新点击“开始清洗”按钮。

* **错误：“发生错误：读取Sheet失败...” 或 "ValueError:..."**
    * **原因**: “Sheet 名称”框中填写的名称，在您的Excel文件中不存在。
    * **解决**: 检查您Excel底部的Sheet标签页名称，确保在程序中输入的名称与其完全一致。